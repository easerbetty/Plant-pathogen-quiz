<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Plant Pathogen Quiz</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .quiz-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
    .card { border: 1px solid #ccc; padding: 10px; border-radius: 8px; background: #f9f9f9; text-align: center; }
    img { max-width: 100%; height: auto; border-radius: 4px; margin-bottom: 10px; }
    input[type="text"] { width: 100%; padding: 6px; border: 1px solid #aaa; border-radius: 4px; }
    .result { margin-top: 10px; font-weight: bold; }
    button { padding: 6px 12px; border: none; border-radius: 4px; background-color: #007bff; color: white; cursor: pointer; }
    button:hover { background-color: #0056b3; }
  </style>
</head>
<body>
  <h1>ü¶† Plant Pathogen Quiz</h1>
  <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–≥–∞–¥–∞—Ç—å —Ä–æ–¥ –ø–∞—Ç–æ–≥–µ–Ω–∞ –ø–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏—è —Ä–∞—Å—Ç–µ–Ω–∏—è. –§–æ—Ç–æ –±–µ—Ä—É—Ç—Å—è —Å iNaturalist.</p>
  <button onclick="generateQuiz()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–≤–∏–∑</button>

  <div id="quiz" class="quiz-container"></div>

  <script>
    const pathogens = [
      { name: "Botrytis", query: "botrytis", answer: "Botrytis" },
      { name: "Puccinia", query: "puccinia", answer: "Puccinia" },
      { name: "Erysiphe", query: "erysiphe", answer: "Erysiphe" },
      { name: "Phytophthora", query: "phytophthora", answer: "Phytophthora" },
      { name: "Taphrina", query: "taphrina", answer: "Taphrina" },
      { name: "Ustilago", query: "ustilago", answer: "Ustilago" }
    ];

    async function generateQuiz() {
      const quiz = document.getElementById('quiz');
      quiz.innerHTML = '';

      for (const pathogen of pathogens) {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<p>üîç ${pathogen.name}</p><p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>`;
        quiz.appendChild(card);

        try {
          const searchRes = await fetch(`https://api.inaturalist.org/v1/search?q=${encodeURIComponent(pathogen.query)}&sources=taxa`);
          const searchData = await searchRes.json();
          const taxonId = searchData.results?.[0]?.record?.id;
          if (!taxonId) throw new Error('–ù–µ—Ç —Ç–∞–∫—Å–æ–Ω–∞');

          const obsRes = await fetch(`https://api.inaturalist.org/v1/observations?taxon_id=${taxonId}&per_page=1&order_by=created_at`);
          const obsData = await obsRes.json();
          const photoUrl = obsData.results?.[0]?.photos?.[0]?.url?.replace('square', 'large');
          if (!photoUrl) throw new Error('–ù–µ—Ç —Ñ–æ—Ç–æ');

          card.innerHTML = `
            <img src="${photoUrl}" alt="${pathogen.name}">
            <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–æ–¥ –ø–∞—Ç–æ–≥–µ–Ω–∞">
            <button onclick="checkAnswer(this, '${pathogen.answer}')">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <div class="result"></div>
          `;
        } catch (err) {
          card.innerHTML = `<p><strong>${pathogen.name}</strong></p><p>‚ùå ${err.message}</p>`;
        }
      }
    }

    function checkAnswer(button, correct) {
      const input = button.previousElementSibling;
      const result = button.nextElementSibling;
      if (input.value.trim().toLowerCase() === correct.toLowerCase()) {
        result.textContent = '‚úÖ –í–µ—Ä–Ω–æ!';
        result.style.color = 'green';
      } else {
        result.textContent = `‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correct}`;
        result.style.color = 'red';
      }
    }
  </script>
</body>
</html>
